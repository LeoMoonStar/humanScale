# PeopleCoin Smart Contracts

## Overview

This directory contains the SUI Move smart contracts for the PeopleCoin platform. The contracts implement a complete system for personal token creation, automated distribution, and enforced buyback obligations.

---

## Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PEOPLECOIN PLATFORM                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Creator Token   â”‚  â”‚ Creator Treasury â”‚  â”‚ Buyback Vault  â”‚  â”‚ Vesting     â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                  â”‚  â”‚                â”‚  â”‚ Vault       â”‚ â”‚
â”‚  â”‚ â€¢ Token mint    â”‚  â”‚ â€¢ Vesting (4yr)  â”‚  â”‚ â€¢ Milestones   â”‚  â”‚ â€¢ Team lock â”‚ â”‚
â”‚  â”‚ â€¢ Metadata      â”‚  â”‚ â€¢ Linear unlock  â”‚  â”‚ â€¢ Collateral   â”‚  â”‚ â€¢ Cliff     â”‚ â”‚
â”‚  â”‚ â€¢ TreasuryCap   â”‚  â”‚ â€¢ Sell & repay   â”‚  â”‚ â€¢ Enforcement  â”‚  â”‚ â€¢ Release   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                    â”‚                     â”‚                            â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                                â”‚                     â”‚                        â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â” â”‚
â”‚  â”‚                         PLATFORM VAULT (Emergency Fund)                      â”‚ â”‚
â”‚  â”‚                                                                               â”‚ â”‚
â”‚  â”‚  â€¢ 100M+ SUI capacity                    â€¢ Dual interest rates               â”‚ â”‚
â”‚  â”‚  â€¢ Emergency loans (5% APR)              â€¢ Auto debt repayment               â”‚ â”‚
â”‚  â”‚  â€¢ Punishment debt (10% APR)             â€¢ Per-creator credit limits         â”‚ â”‚
â”‚  â”‚  â€¢ Collateral backing                    â€¢ Time-based interest calc          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         INSURANCE POOL (Safety Net)                           â”‚ â”‚
â”‚  â”‚                                                                                â”‚ â”‚
â”‚  â”‚  â€¢ Deficit coverage when platform vault insufficient                         â”‚ â”‚
â”‚  â”‚  â€¢ 1% fee on all trades â†’ insurance fund                                     â”‚ â”‚
â”‚  â”‚  â€¢ Covers extreme scenarios (token price spikes 10x)                         â”‚ â”‚
â”‚  â”‚  â€¢ Last resort protection for all investors                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚         AMM LIQUIDITY POOL (Trading)          â”‚
              â”‚                                               â”‚
              â”‚  â€¢ Constant product (x * y = k)              â”‚
              â”‚  â€¢ Creator/SUI pairs                         â”‚
              â”‚  â€¢ 0.3% trading fee                          â”‚
              â”‚  â€¢ Price discovery & liquidity               â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Core Contracts

1. **`creator_token.move`** - Fungible Token Generation
   - Creates unique creator tokens using SUI's Coin standard
   - One-time witness pattern ensures each creator gets a unique token type
   - Handles initial distribution (creator treasury, platform reserve, liquidity pool)
   - Stores immutable token metadata and buyback configuration

2. **`creator_treasury.move`** - Creator Token Vesting & Sales
   - 4-year linear vesting for creator's allocated tokens
   - 2% monthly unlock rate (48 months total)
   - `sell_and_repay_debt()` - Automatic debt deduction from sale proceeds
   - Prevents dumping, ensures creator commitment

3. **`vesting_vault.move`** - Team/Advisor Vesting
   - Lock tokens for team, advisors, early supporters
   - Custom cliff periods (e.g., 1 year cliff, 3 year vest)
   - Linear unlock schedule after cliff
   - Prevents early dumping by insiders

4. **`buyback_vault.move`** - Buyback Schedule & Enforcement
   - Enforces creator's buyback obligations over 5-10 years
   - Milestone-based schedule with automatic deadline enforcement
   - Integrates with platform vault for emergency borrowing
   - On-chain debt tracking when creators default
   - Collateral management for investor protection
   - Automatic buyback execution via AMM

5. **`platform_vault.move`** - Centralized Emergency Fund
   - **NEW**: Large SUI pool (100M+ capacity) for all creators
   - **Emergency Loans**: 5% APR when creator's collateral insufficient
   - **Punishment Debt**: 10% APR penalty for missing buyback deadlines
   - Per-creator credit limits (default: 500K SUI)
   - Time-based interest calculation and compounding
   - Auto-deduction from creator sales

6. **`insurance.move`** - Platform-Wide Safety Net
   - Covers extreme scenarios (platform vault exhausted)
   - Funded by 1% fee on all AMM trades
   - Deficit coverage when buyback costs exceed expectations
   - Protects entire ecosystem from systemic risk

7. **`distribution.move`** - Automated Reserve Distribution
   - Stage 2: Keeps distributing platform-held tokens to market
   - Time-locked releases at regular intervals (e.g., every 3 months)
   - Ensures continuous liquidity availability
   - Prevents token hoarding and maintains market activity

8. **`amm.move`** - Automated Market Maker
   - Constant product formula (x Ã— y = k)
   - Creator token <> SUI trading pairs
   - 0.3% trading fee (split: 0.2% LP, 0.1% platform)
   - Liquidity provision and removal
   - Price quotes for buyback enforcement

---

## Token Lifecycle (3 Stages)

### Stage 1: Generation & Setup
```
Creator submits application â†’ KYC approval â†’ Contract deployment
```

**On-chain actions:**
- Deploy unique token with `create_token()`
- Set total supply, allocations, buyback duration
- Create `BuybackVault` with collateral
- Create `DistributionVault` with reserve tokens
- Seed liquidity pool with initial allocation

**Initial Distribution:**
- Creator: 30% (example)
- Platform Reserve: 30%
- Liquidity Pool: 40%

### Stage 2: Keep Distributing
```
Every X months â†’ Platform releases reserve tokens to liquidity pool
```

**On-chain actions:**
- `execute_distribution()` is called when milestone time is reached
- Tokens automatically released from `DistributionVault`
- Added to liquidity pool to maintain supply
- Anyone can trigger (permissionless execution)

**Duration:** Until reserve fully distributed or buyback phase begins

### Stage 3: Free Trading & Buyback
```
Creator must buy back and burn tokens according to schedule
```

**On-chain actions:**
- Creator calls `execute_buyback()` before each deadline
- If deadline missed â†’ `check_and_enforce_default()` triggers automatic buyback
- Collateral used to purchase tokens from market
- Debt recorded on-chain if collateral insufficient
- Trading continues 24/7 on AMM

---

## Complete Flow Diagrams

### 1. Token Creation & Initialization Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Creator Submits Application                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Creator â†’ Frontend Form â†’ Backend API                                   â”‚
â”‚ Data: name, symbol, total_supply, buyback_schedule, collateral         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: KYC & Approval                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Backend validates â†’ KYC check â†’ Admin approval                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Deploy Token Contract                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ creator_token::create_token<T>()                                        â”‚
â”‚   â”‚                                                                      â”‚
â”‚   â”œâ”€â†’ Mint total supply (e.g., 10M tokens)                             â”‚
â”‚   â”œâ”€â†’ Create TokenRegistry (metadata + buyback config)                 â”‚
â”‚   â”œâ”€â†’ Return TreasuryCap (for burning)                                 â”‚
â”‚   â””â”€â†’ Emit TokenCreated event                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Initialize Vaults & Distribution                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Creator Treasury      â”‚  â”‚ Buyback Vault    â”‚  â”‚ AMM Liquidity    â”‚ â”‚
â”‚ â”‚                       â”‚  â”‚                  â”‚  â”‚ Pool             â”‚ â”‚
â”‚ â”‚ â€¢ 30% of supply       â”‚  â”‚ â€¢ Creator posts  â”‚  â”‚ â€¢ 40% of supply  â”‚ â”‚
â”‚ â”‚ â€¢ 4-year vesting      â”‚  â”‚   collateral     â”‚  â”‚ â€¢ Initial SUI    â”‚ â”‚
â”‚ â”‚ â€¢ 2% monthly unlock   â”‚  â”‚ â€¢ Milestones set â”‚  â”‚ â€¢ Trading starts â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚ Platform Reserve: 30% â†’ distribution::DistributionVault                â”‚
â”‚                         (released over 3 years)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result:
âœ… Token deployed and tradable
âœ… Creator allocation vesting
âœ… Buyback schedule active
âœ… Liquidity available for trading
```

### 2. Buyback Enforcement Flow (Default Scenario)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TRIGGER: Buyback Deadline Passes (Creator Missed It)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Milestone 3: Due Jul 15, 2024 at 23:59 UTC                            â”‚
â”‚ Required: Burn 1,000 tokens                                            â”‚
â”‚ Status: âŒ NOT COMPLETED                                                â”‚
â”‚ Current time: Jul 16, 2024 00:01 UTC                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Default Detection                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ check_and_enforce_default<T>() called by:                              â”‚
â”‚   â€¢ Platform keeper bot (automated)                                    â”‚
â”‚   â€¢ Any user (permissionless)                                          â”‚
â”‚   â€¢ Frontend alert system                                              â”‚
â”‚                                                                          â”‚
â”‚ Check: current_time > deadline && !milestone.completed                 â”‚
â”‚ Result: âœ… DEFAULT DETECTED                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Calculate Buyback Cost                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ amm::quote_token_to_sui(pool, 1000 tokens)                             â”‚
â”‚                                                                          â”‚
â”‚ AMM Calculation:                                                        â”‚
â”‚   Token reserve: 400,000 tokens                                        â”‚
â”‚   SUI reserve: 600,000 SUI                                             â”‚
â”‚   Price: ~1.50 SUI/token                                               â”‚
â”‚   Cost to buy 1,000 tokens: ~1,520 SUI (includes slippage)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Check Collateral                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ vault.collateral_balance = 500 SUI                                     â”‚
â”‚ Required: 1,520 SUI                                                    â”‚
â”‚ Deficit: 1,020 SUI âŒ                                                   â”‚
â”‚                                                                          â”‚
â”‚ Decision: INSUFFICIENT â†’ Borrow from Platform Vault                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Borrow from Platform Vault                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ platform_vault::borrow(                                                 â”‚
â”‚   creator: Alice,                                                       â”‚
â”‚   amount: 1,020 SUI,                                                   â”‚
â”‚   borrower_vault_id: vault_id                                          â”‚
â”‚ )                                                                       â”‚
â”‚                                                                          â”‚
â”‚ Platform Vault Checks:                                                 â”‚
â”‚   âœ… Credit limit: 500K SUI (sufficient)                               â”‚
â”‚   âœ… Current borrowed: 0 SUI                                            â”‚
â”‚   âœ… Available: 1,020 SUI                                              â”‚
â”‚                                                                          â”‚
â”‚ Result:                                                                 â”‚
â”‚   â€¢ Loan created: 1,020 SUI @ 5% APR                                   â”‚
â”‚   â€¢ Coin<SUI>(1,020) returned                                          â”‚
â”‚   â€¢ Event: LoanIssued emitted                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Execute Buyback on AMM                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Total SUI available:                                                    â”‚
â”‚   â€¢ Collateral: 500 SUI (all extracted)                                â”‚
â”‚   â€¢ Borrowed: 1,020 SUI                                                â”‚
â”‚   â€¢ Total: 1,520 SUI                                                   â”‚
â”‚                                                                          â”‚
â”‚ amm::swap_sui_for_token<T>(                                            â”‚
â”‚   pool,                                                                 â”‚
â”‚   sui_coin: Coin<SUI>(1,520),                                          â”‚
â”‚   min_tokens: 0  // Emergency, accept any amount                       â”‚
â”‚ )                                                                       â”‚
â”‚                                                                          â”‚
â”‚ Result:                                                                 â”‚
â”‚   â€¢ Tokens bought: ~1,000 tokens                                       â”‚
â”‚   â€¢ 1% insurance fee: 15.2 SUI â†’ Insurance pool                        â”‚
â”‚   â€¢ Pool updated: (399K tokens, 601.5K SUI)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: Burn Tokens                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ coin::burn(treasury_cap, tokens_bought)                                â”‚
â”‚                                                                          â”‚
â”‚ Result:                                                                 â”‚
â”‚   â€¢ 1,000 tokens permanently destroyed                                 â”‚
â”‚   â€¢ Total supply reduced                                               â”‚
â”‚   â€¢ Milestone marked completed (forced)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: Record Dual Obligations                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ A) Platform Vault Loan:                                                â”‚
â”‚    â€¢ Principal: 1,020 SUI                                              â”‚
â”‚    â€¢ Interest rate: 5% APR                                             â”‚
â”‚    â€¢ Created: Jul 16, 2024                                             â”‚
â”‚    â€¢ Must be repaid separately                                         â”‚
â”‚                                                                          â”‚
â”‚ B) Punishment Debt (creator_debt):                                     â”‚
â”‚    platform_vault::create_creator_debt(                                â”‚
â”‚       creator: Alice,                                                   â”‚
â”‚       amount: 1,520 SUI  // FULL buyback cost                          â”‚
â”‚    )                                                                    â”‚
â”‚    â€¢ Principal: 1,520 SUI                                              â”‚
â”‚    â€¢ Interest rate: 10% APR                                            â”‚
â”‚    â€¢ Auto-deducted from future sales                                   â”‚
â”‚                                                                          â”‚
â”‚ Events Emitted:                                                         â”‚
â”‚   â€¢ DefaultTriggered(vault_id, milestone_3, 1520 SUI)                 â”‚
â”‚   â€¢ DebtCreated(Alice, 1520 SUI)                                       â”‚
â”‚   â€¢ LoanIssued(Alice, 1020 SUI)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Final State:
âœ… Milestone completed (forced)
âœ… Tokens burned
âš ï¸  Creator owes:
    - Loan: 1,020 SUI @ 5% APR (to platform vault)
    - Debt: 1,520 SUI @ 10% APR (punishment)
ğŸ“§ Notifications sent to creator & investors
```

### 3. Debt Repayment Flow (Creator Sells Tokens)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SCENARIO: Creator Alice Sells Tokens After 30 Days in Debt             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Current debt: 1,520 SUI principal                                      â”‚
â”‚ Days in debt: 30 days                                                  â”‚
â”‚ Interest accrued: ~12.49 SUI (10% APR Ã— 30 days)                       â”‚
â”‚ Total owed: 1,532.49 SUI                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Creator Unlocks Vested Tokens                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ creator_treasury::update_vesting()                                      â”‚
â”‚                                                                          â”‚
â”‚ Vesting calculation:                                                    â”‚
â”‚   â€¢ Start: 3M tokens allocated (30% of 10M)                            â”‚
â”‚   â€¢ Monthly unlock: 2% = 60K tokens/month                              â”‚
â”‚   â€¢ Months elapsed: 30 days = 1 month                                  â”‚
â”‚   â€¢ Now vested: 60K tokens                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Creator Sells on AMM                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Creator â†’ AMM Frontend â†’ Swap 50,000 tokens for SUI                    â”‚
â”‚                                                                          â”‚
â”‚ amm::swap_token_for_sui(pool, 50K tokens)                              â”‚
â”‚                                                                          â”‚
â”‚ AMM State:                                                              â”‚
â”‚   Before: (399K tokens, 601.5K SUI)                                    â”‚
â”‚   After: (449K tokens, 534.8K SUI)                                     â”‚
â”‚   SUI received: ~66,700 SUI                                            â”‚
â”‚   Insurance fee (1%): ~667 SUI â†’ Insurance pool                        â”‚
â”‚   Net proceeds: ~66,033 SUI                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Call sell_and_repay_debt()                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ creator_treasury::sell_and_repay_debt<T>(                              â”‚
â”‚   treasury,                                                             â”‚
â”‚   platform_vault,                                                       â”‚
â”‚   tokens_amount: 50,000,                                               â”‚
â”‚   sui_proceeds: Coin<SUI>(66,033),                                     â”‚
â”‚   clock,                                                                â”‚
â”‚   ctx                                                                   â”‚
â”‚ )                                                                       â”‚
â”‚                                                                          â”‚
â”‚ Function flow:                                                          â”‚
â”‚   1. Deduct from vested amount                                         â”‚
â”‚   2. Check if creator has debt                                         â”‚
â”‚   3. If yes â†’ repay_creator_debt()                                     â”‚
â”‚   4. If no â†’ transfer all proceeds to creator                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Automatic Debt Deduction                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ platform_vault::repay_creator_debt()                                    â”‚
â”‚                                                                          â”‚
â”‚ Debt calculation:                                                       â”‚
â”‚   â€¢ Principal: 1,520 SUI                                               â”‚
â”‚   â€¢ Interest: (1520 Ã— 1000 Ã— 2592000) / (10000 Ã— 31536000) = 12.49 SUIâ”‚
â”‚   â€¢ Total owed: 1,532.49 SUI                                           â”‚
â”‚                                                                          â”‚
â”‚ Payment split:                                                          â”‚
â”‚   Sale proceeds: 66,033 SUI                                            â”‚
â”‚   Debt payment: 1,532.49 SUI                                           â”‚
â”‚                                                                          â”‚
â”‚   â†’ Interest paid first: 12.49 SUI                                     â”‚
â”‚      (vault.total_interest_earned += 12.49)                            â”‚
â”‚   â†’ Principal paid: 1,520 SUI                                          â”‚
â”‚      (vault.balance += 1,520)                                          â”‚
â”‚   â†’ Remainder to creator: 64,500.51 SUI                                â”‚
â”‚                                                                          â”‚
â”‚ Debt status:                                                            â”‚
â”‚   Before: 1,532.49 SUI owed                                            â”‚
â”‚   After: 0 SUI âœ… DEBT CLEARED                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESULT                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Alice receives: 64,500.51 SUI                                          â”‚
â”‚ Platform vault receives: 1,532.49 SUI                                  â”‚
â”‚ Debt cleared: âœ…                                                         â”‚
â”‚                                                                          â”‚
â”‚ Note: Loan (1,020 SUI @ 5% APR) still outstanding                     â”‚
â”‚       Must be repaid separately or from next sale                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Interest Accumulation Over Time

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEBT: 1,520 SUI @ 10% APR (Punishment Debt)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ Formula:                                                                â”‚
â”‚   interest = (principal Ã— rate_bps Ã— time_seconds) / (10000 Ã— 31536000)â”‚
â”‚   where rate_bps = 1000 (10% APR)                                      â”‚
â”‚                                                                          â”‚
â”‚ Time-based accumulation:                                                â”‚
â”‚                                                                          â”‚
â”‚   Day 1:  1,520.00 + 0.42 = 1,520.42 SUI                               â”‚
â”‚   Day 7:  1,520.00 + 2.90 = 1,522.90 SUI                               â”‚
â”‚   Day 30: 1,520.00 + 12.49 = 1,532.49 SUI                              â”‚
â”‚   Day 90: 1,520.00 + 37.48 = 1,557.48 SUI                              â”‚
â”‚   Day 180: 1,520.00 + 74.96 = 1,594.96 SUI                             â”‚
â”‚   Day 365: 1,520.00 + 152.00 = 1,672.00 SUI (+10%)                     â”‚
â”‚                                                                          â”‚
â”‚ Key insight: Interest grows linearly but compounds on payment          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LOAN: 1,020 SUI @ 5% APR (Platform Vault Loan)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ Formula: Same, but rate_bps = 500 (5% APR)                            â”‚
â”‚                                                                          â”‚
â”‚   Day 1:  1,020.00 + 0.14 = 1,020.14 SUI                               â”‚
â”‚   Day 30: 1,020.00 + 4.19 = 1,024.19 SUI                               â”‚
â”‚   Day 90: 1,020.00 + 12.58 = 1,032.58 SUI                              â”‚
â”‚   Day 365: 1,020.00 + 51.00 = 1,071.00 SUI (+5%)                       â”‚
â”‚                                                                          â”‚
â”‚ Incentive: Lower rate for legitimate borrowing vs. punishment          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. Multi-Layer Safety Net

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EXTREME SCENARIO: Token Price Spikes 10x Unexpectedly                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Milestone 5: Burn 1,000 tokens                                         â”‚
â”‚ Previous price: 1.50 SUI/token                                         â”‚
â”‚ New price: 15.00 SUI/token (10x spike!)                                â”‚
â”‚ Buyback cost: 15,000 SUI                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 1: Creator's Collateral                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Available: 0 SUI (exhausted in previous default)                       â”‚
â”‚ Status: âŒ INSUFFICIENT                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 2: Platform Vault                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Creator credit limit: 500K SUI                                         â”‚
â”‚ Current borrowed: 1,020 SUI                                            â”‚
â”‚ Available credit: 498,980 SUI                                          â”‚
â”‚ Need: 15,000 SUI                                                       â”‚
â”‚ Status: âœ… SUFFICIENT                                                   â”‚
â”‚                                                                          â”‚
â”‚ Action:                                                                 â”‚
â”‚   â€¢ Borrow 15,000 SUI @ 5% APR                                         â”‚
â”‚   â€¢ Execute buyback on AMM                                             â”‚
â”‚   â€¢ Record loan + punishment debt (15K @ 10% APR)                      â”‚
â”‚   â€¢ Milestone completed                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 3: Insurance Pool (If Platform Vault Exhausted)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Scenario: Platform vault has only 10K SUI left, need 15K              â”‚
â”‚                                                                          â”‚
â”‚ Insurance pool balance: 500K SUI (from 1% trade fees)                 â”‚
â”‚ Deficit: 5K SUI                                                        â”‚
â”‚                                                                          â”‚
â”‚ Action:                                                                 â”‚
â”‚   insurance::cover_deficit(pool, 5000)                                 â”‚
â”‚   â€¢ Insurance claims recorded                                          â”‚
â”‚   â€¢ Platform vault gets 5K SUI injection                              â”‚
â”‚   â€¢ Buyback proceeds                                                   â”‚
â”‚   â€¢ Creator debt increased by deficit amount                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result: System protects investors across all scenarios
```

---

## Automation Strategy

### 1. Token Generation Automation

**Backend Service Implementation:**

```typescript
// Backend API endpoint: POST /api/creator/deploy-token

async function deployCreatorToken(creatorData) {
  // 1. Verify KYC and approval status
  const kyc = await verifyKYC(creatorData.userId);
  if (!kyc.approved) throw new Error("KYC not approved");

  // 2. Generate unique token witness type
  const tokenWitness = generateUniqueWitness(creatorData.userId);

  // 3. Prepare contract deployment transaction
  const tx = new Transaction();

  // 4. Call create_token with creator's parameters
  tx.moveCall({
    target: `${PACKAGE_ID}::creator_token::create_token`,
    typeArguments: [tokenWitness],
    arguments: [
      tx.pure(8),  // decimals
      tx.pure(creatorData.tokenSymbol),
      tx.pure(creatorData.tokenName),
      tx.pure(creatorData.description),
      tx.pure(creatorData.iconUrl),
      tx.pure(creatorData.totalSupply),
      tx.pure(creatorData.creatorAllocation),
      tx.pure(creatorData.platformReserve),
      tx.pure(creatorData.liquidityAllocation),
      tx.pure(creatorData.buybackDurationYears),
      tx.pure(creatorData.initialPriceUsd),
    ],
  });

  // 5. Sign with platform admin key and execute
  const result = await signAndExecute(tx);

  // 6. Store contract addresses in database
  await saveContractAddresses(creatorData.userId, result);

  // 7. Create buyback vault
  await deployBuybackVault(creatorData, result.tokenType);

  // 8. Create distribution vault
  await deployDistributionVault(creatorData, result.tokenType);

  return result;
}
```

**Key Components:**
- **Backend API**: Express/FastAPI endpoint that orchestrates deployment
- **SUI SDK**: `@mysten/sui.js` for transaction building and execution
- **Wallet Management**: Platform admin wallet with deployment permissions
- **Database**: Store token addresses, vault IDs, creator mappings

**Deployment Flow:**
```
User submits form â†’ Frontend calls /api/creator/deploy-token
â†’ Backend validates KYC â†’ Generates unique witness type
â†’ Builds Move transaction â†’ Signs with admin wallet
â†’ Executes on SUI blockchain â†’ Stores addresses in DB
â†’ Returns success to user
```

---

### 2. Automated Distribution (Stage 2)

**Cron Job Implementation:**

```typescript
// Run every hour
cron.schedule('0 * * * *', async () => {
  // 1. Query all active distribution vaults from database
  const vaults = await db.getActiveDistributionVaults();

  for (const vault of vaults) {
    // 2. Check if next milestone is ready
    const nextTime = await getNextDistributionTime(vault.id);
    const currentTime = Date.now();

    if (currentTime >= nextTime) {
      // 3. Execute distribution transaction
      const tx = new Transaction();
      tx.moveCall({
        target: `${PACKAGE_ID}::distribution::execute_distribution`,
        typeArguments: [vault.tokenType],
        arguments: [
          tx.object(vault.vaultId),
          tx.object(CLOCK_OBJECT_ID),
        ],
      });

      // 4. Anyone can execute (no auth needed)
      await executeTransaction(tx);

      // 5. Log execution
      console.log(`Distributed tokens for vault ${vault.id}`);
    }
  }
});
```

**Alternative: Keeper Network Integration**

Instead of centralized cron jobs, use decentralized keepers:

- **Gelato Network**: Automated smart contract execution
- **Chainlink Keepers**: Time-based or custom logic triggers
- **Custom Keeper Bot**: Monitor blockchain events and execute

**Benefits:**
- Permissionless (anyone can trigger)
- Decentralized execution
- No single point of failure
- Gas costs paid by trigger mechanism

---

### 3. Automated Buyback Enforcement

**Default Detection Service:**

```typescript
// Run every day
cron.schedule('0 0 * * *', async () => {
  // 1. Query all buyback vaults
  const vaults = await db.getActiveBuybackVaults();

  for (const vault of vaults) {
    // 2. Check vault status on-chain
    const status = await getBuybackVaultStatus(vault.id);

    // 3. Check if current milestone is overdue
    const milestone = await getCurrentMilestone(vault.id);
    const currentTime = Date.now();

    if (currentTime > milestone.deadline && !milestone.completed) {
      // 4. Trigger automatic enforcement
      const tx = new Transaction();
      tx.moveCall({
        target: `${PACKAGE_ID}::buyback_vault::check_and_enforce_default`,
        typeArguments: [vault.tokenType],
        arguments: [
          tx.object(vault.vaultId),
          tx.object(CLOCK_OBJECT_ID),
        ],
      });

      await executeTransaction(tx);

      // 5. Send alerts
      await sendDefaultAlert(vault.creatorId);
      await notifyInvestors(vault.id);

      // 6. Trigger legal process if needed
      if (status.debt > LEGAL_THRESHOLD) {
        await initiateLegalAction(vault.creatorId);
      }
    }
  }
});
```

**Automatic Buyback Execution (Future Enhancement):**

Currently `check_and_enforce_default()` records the default. To make it fully automatic:

```move
// In buyback_vault.move, add AMM integration:

public entry fun check_and_enforce_default<T>(
    vault: &mut BuybackVault<T>,
    amm_pool: &mut Pool<T, SUI>,  // AMM pool reference
    clock: &Clock,
    ctx: &mut TxContext
) {
    // ... existing deadline check ...

    if (is_defaulted) {
        // Use collateral to buy tokens from market
        let collateral_amount = calculate_required_collateral(milestone);
        let collateral_coin = extract_collateral(vault, collateral_amount);

        // Swap SUI for tokens on AMM
        let tokens_bought = swap_sui_for_tokens(
            amm_pool,
            collateral_coin,
            milestone.required_burn_amount,
            ctx
        );

        // Burn the tokens
        burn_tokens(treasury_cap, tokens_bought);

        // Record debt if insufficient
        // ... debt tracking logic ...
    }
}
```

---

## Automation Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Backend Services                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  Token Deployer  â”‚  â”‚  Keeper Service  â”‚                 â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚                 â”‚
â”‚  â”‚  â€¢ KYC check     â”‚  â”‚  â€¢ Cron jobs     â”‚                 â”‚
â”‚  â”‚  â€¢ Witness gen   â”‚  â”‚  â€¢ Distribution  â”‚                 â”‚
â”‚  â”‚  â€¢ TX builder    â”‚  â”‚  â€¢ Default check â”‚                 â”‚
â”‚  â”‚  â€¢ DB storage    â”‚  â”‚  â€¢ Alerts        â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚           â”‚                     â”‚                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚
            â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SUI Blockchain                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ CreatorToken   â”‚  â”‚ BuybackVault â”‚  â”‚ DistributionVaultâ”‚  â”‚
â”‚  â”‚                â”‚  â”‚              â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚ â€¢ Token mint   â”‚  â”‚ â€¢ Milestones â”‚  â”‚ â€¢ Reserve tokens â”‚  â”‚
â”‚  â”‚ â€¢ Metadata     â”‚  â”‚ â€¢ Collateral â”‚  â”‚ â€¢ Auto-release   â”‚  â”‚
â”‚  â”‚ â€¢ Allocations  â”‚  â”‚ â€¢ Debt track â”‚  â”‚ â€¢ Liquidity mgmt â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚                     â”‚
            â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AMM Pool                             â”‚
â”‚         (DeepBook or Custom Constant Product AMM)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Metrics & Formulas

### Interest Calculation

**Formula:**
```
interest = (principal Ã— rate_bps Ã— time_seconds) / (BASIS_POINTS Ã— SECONDS_PER_YEAR)

Where:
- BASIS_POINTS = 10,000
- SECONDS_PER_YEAR = 31,536,000
- rate_bps for platform loans = 500 (5% APR)
- rate_bps for punishment debt = 1,000 (10% APR)
```

**Example:**
```
Debt: 1,000 SUI
Rate: 10% APR (1000 bps)
Time: 30 days (2,592,000 seconds)

interest = (1000 Ã— 1000 Ã— 2592000) / (10000 Ã— 31536000)
         = 2,592,000,000 / 315,360,000,000
         = 0.00822 Ã— 1000
         = 8.22 SUI
```

### AMM Constant Product Formula

**x Ã— y = k**

Where:
- x = Token reserve
- y = SUI reserve
- k = Constant product

**Price Calculation:**
```
Price = SUI_reserve / Token_reserve

Example:
- Token reserve: 400,000
- SUI reserve: 600,000
- Price: 600,000 / 400,000 = 1.5 SUI per token
```

**Swap Calculation (Token â†’ SUI):**
```
Given: Sell Î”x tokens
Get: Î”y SUI

Formula:
Î”y = (y Ã— Î”x) / (x + Î”x)

Example:
- Sell 1,000 tokens
- Î”y = (600,000 Ã— 1,000) / (400,000 + 1,000)
- Î”y = 600,000,000 / 401,000
- Î”y â‰ˆ 1,496 SUI (before fees)
```

### Vesting Schedule

**Creator Treasury (4 years):**
```
Total allocation: 30% of supply
Vesting period: 48 months
Monthly unlock: 2% (1/48 of allocation)
Cliff: None (starts immediately)

Example:
- Total supply: 10M tokens
- Creator allocation: 3M tokens
- Monthly unlock: 3M Ã— 2% = 60,000 tokens
- After 12 months: 720,000 tokens vested (24%)
- After 48 months: 3M tokens fully vested
```

**Team/Advisor Vesting:**
```
Customizable parameters:
- Cliff period: 0-24 months
- Vesting period: 12-60 months
- Linear unlock after cliff

Example (1-year cliff, 3-year vest):
- Month 0-12: 0 tokens (cliff)
- Month 13-48: Linear unlock (1/36 per month)
```

### Buyback Schedule

**Milestone Calculation:**
```
Total duration: 5-10 years
Number of milestones: configurable
Interval = Total duration / Number of milestones

Example (5 years, 20 milestones):
- Interval: 60 months / 20 = 3 months
- Milestone 1: Month 3
- Milestone 2: Month 6
- Milestone 20: Month 60
```

### Fee Structure

**Trading Fees:**
```
AMM swap fee: 0.3% total
- LP providers: 0.2%
- Platform: 0.1%

Insurance fee: 1% on all swaps
- Goes to insurance pool
- Covers extreme scenarios
```

**Interest Rates:**
```
Platform Vault Loan: 5% APR
- For emergency buyback borrowing
- Legitimate cost of capital

Punishment Debt: 10% APR
- For missing buyback deadlines
- Penalty to incentivize compliance
- Auto-deducted from sales
```

---

## Component Reference Table

| Component | Purpose | Key Functions | State |
|-----------|---------|---------------|-------|
| **creator_token** | Token minting | `create_token()` | TreasuryCap, TokenRegistry |
| **creator_treasury** | Creator vesting | `sell_and_repay_debt()`, `update_vesting()` | 4yr vest, 2% monthly |
| **vesting_vault** | Team/advisor vesting | `release_vested()` | Custom cliff/vest |
| **buyback_vault** | Buyback enforcement | `execute_buyback()`, `check_and_enforce_default()` | Milestones, collateral, debt |
| **platform_vault** | Emergency fund | `borrow()`, `repay_creator_debt()` | 100M SUI, loans, debts |
| **insurance** | Safety net | `cover_deficit()`, `collect_fee()` | Insurance pool, claims |
| **distribution** | Platform reserves | `execute_distribution()` | Time-locked releases |
| **amm** | Trading | `swap_sui_for_token()`, `add_liquidity()` | xÃ—y=k pools |

---

## Testing Coverage

### Unit Tests
- âœ… `creator_token_tests.move` - Token creation, metadata
- âœ… `creator_treasury_tests.move` - Vesting, debt repayment
- âœ… `buyback_vault_tests.move` - Milestones, enforcement
- âœ… `platform_vault_tests.move` - Loans, debts, interest
- âœ… `insurance_tests.move` - Fee collection, deficit coverage
- âœ… `amm_tests.move` - Swaps, liquidity, pricing

### Integration Tests
- âœ… `integration_tests.move` - Full system flows
  - Token creation â†’ vesting â†’ trading â†’ buyback
  - Default scenarios with platform vault
  - Multi-creator interactions
  - Edge cases (price spikes, insufficient funds)

### Test Commands
```bash
# Run all tests
sui move test

# Run specific test module
sui move test --filter creator_token_tests

# Run with coverage
sui move test --coverage

# Build without tests (faster)
sui move build
```

---

## Documentation Files

- **`CONTRACT_UPDATES.md`** - Recent changes and updates
- **`IMPLEMENTATION_SUMMARY.md`** - Platform vault implementation details
- **`PLATFORM_VAULT_SYSTEM.md`** - Comprehensive vault documentation
- **`TREASURY_SYSTEM.md`** - Treasury and vesting documentation
- **`README.md`** - This file (system overview and flows)

---

## Quick Start Guide

### 1. Build & Test
```bash
cd contracts
sui move build
sui move test
```

### 2. Deploy (Testnet)
```bash
sui client publish --gas-budget 100000000
```

### 3. Initialize Platform Vault
```bash
# From frontend or CLI
platform_vault::create_vault(
  initial_fund: 100_000_000_000,  // 100M SUI
  default_credit_limit: 500_000_000,  // 500K per creator
)
```

### 4. Create First Token
```bash
creator_token::create_token<ALICE>(
  decimals: 8,
  symbol: "ALICE",
  name: "Alice Token",
  total_supply: 10_000_000,
  ...
)
```

### 5. Monitor Events
```bash
# Listen for key events
- TokenCreated
- MilestoneCompleted
- DefaultTriggered
- DebtCreated
- DebtRepaid
- LoanIssued
```

---

## Security Considerations

### 1. **Collateral Requirements**
- Creators must lock SUI as collateral (e.g., 2x expected buyback cost)
- Protects investors if creator defaults
- Enables automatic market buyback

### 2. **Immutable Schedules**
- Buyback schedule set at creation, cannot be changed
- Distribution intervals fixed
- Prevents creator manipulation

### 3. **On-Chain Debt Tracking**
- All defaults recorded permanently
- Transparent for investors
- Legal enforcement evidence

### 4. **Permissionless Execution**
- Anyone can trigger distribution/enforcement
- Reduces platform centralization risk
- Keeper networks can automate

### 5. **Time Oracle (Clock)**
- Uses SUI's Clock object for timestamps
- Prevents time manipulation
- Consistent across all contracts

---

## Gas Optimization

### Efficient Data Structures
- Use `vector` for bounded lists (milestones)
- `Balance` instead of `Coin` for storage
- Minimal on-chain storage (metadata only)

### Batching
- Distribute multiple creator tokens in single TX
- Batch buyback checks for gas savings

### Event-Driven Indexing
- Emit events for all state changes
- Backend indexes events instead of querying chain
- Reduces RPC calls

---

## Testing Strategy

### Unit Tests
```bash
sui move test
```

Test coverage:
- Token creation with various allocations
- Buyback execution (on-time and late)
- Distribution milestone triggers
- Debt recording and collateral usage
- Edge cases (zero amounts, invalid schedules)

### Integration Tests
- Deploy all contracts on testnet
- Simulate full creator lifecycle
- Test automation scripts
- Verify event emissions

### Stress Tests
- Deploy 100+ creator tokens
- Measure gas costs at scale
- Test concurrent operations

---

## Deployment Guide

### 1. Build Contracts
```bash
cd contracts
sui move build
```

### 2. Deploy to Testnet
```bash
sui client publish --gas-budget 100000000
```

### 3. Save Package ID
```bash
export PACKAGE_ID=0x...
```

### 4. Initialize Platform
```typescript
// Create platform admin wallet
// Fund with testnet SUI
// Store private key securely (use KMS in production)
```

### 5. Test Token Deployment
```bash
# Use SUI CLI or TypeScript SDK
```

---

## AMM Integration (Next Step)

For trading to work, we need an AMM. Two options:

### Option 1: Use SUI DeepBook
- SUI's native CLOB (Central Limit Order Book)
- High liquidity, low slippage
- Requires DeepBook integration

### Option 2: Custom Constant Product AMM
- Simple x * y = k formula
- Independent liquidity pools per creator
- Full control over fees and parameters

**Recommendation:** Start with custom AMM for MVP, migrate to DeepBook later for liquidity aggregation.

---

## Feedback & Design Analysis

### âœ… Strengths

1. **Fully On-Chain Enforcement**
   - No off-chain trust required for buybacks
   - Smart contracts enforce all obligations
   - Transparent and auditable

2. **Automated Distribution**
   - Stage 2 ensures continuous liquidity
   - Prevents "all tokens locked" scenario
   - Time-locked releases maintain fairness

3. **Debt Tracking**
   - On-chain record of defaults
   - Legal enforcement evidence
   - Transparent investor protection

4. **Flexible Schedules**
   - 5-10 year buyback periods
   - Customizable milestones
   - Monthly/quarterly distributions

5. **Collateral Security**
   - Creators lock funds upfront
   - Automatic buyback possible
   - Reduces investor risk

### âš ï¸ Challenges & Considerations

1. **AMM Liquidity Risk**
   - If token price spikes, creator may not afford buyback
   - Need sufficient initial liquidity
   - **Solution:** Minimum collateral = 2x market cap, dynamic adjustment

2. **Oracle Dependency**
   - Automatic buyback needs price oracle
   - SUI oracle landscape still developing
   - **Solution:** Use Pyth Network or Switchboard oracles

3. **Gas Costs**
   - Automated executions cost gas
   - Who pays for keeper operations?
   - **Solution:** Reserve 1% of token supply for gas fees, keeper rewards

4. **Legal Enforceability**
   - On-chain debt â‰  automatic legal action
   - Still requires off-chain legal framework
   - **Solution:** Smart contracts + legal agreements (DocuSign integration)

5. **Creator Liquidity Burden**
   - Buyback schedule might be too aggressive
   - Creator income may fluctuate
   - **Solution:** Grace periods, partial buyback options, flexible schedules

### ğŸš€ Recommended Enhancements

1. **Add Grace Periods**
   - Allow 30-day grace period before default
   - Creator can request extension (requires community vote)

2. **Partial Buyback Support**
   - Allow buying back portion of milestone
   - Pro-rate remaining obligations

3. **Dynamic Collateral Adjustment**
   - Monitor token price
   - Request additional collateral if price rises
   - Protect against "too successful" scenario

4. **Community Governance**
   - Token holders vote on schedule modifications
   - Weighted voting based on holdings
   - Prevents creator unilateral changes

5. **Insurance Pool**
   - Platform-wide insurance fund
   - Cover defaults beyond collateral
   - Funded by platform fees (e.g., 0.5% trading fee)

---

## Next Steps

1. âœ… **Core contracts complete** (creator_token, buyback_vault, distribution)
2. â³ **Add AMM contract** (constant product or DeepBook integration)
3. â³ **Write comprehensive tests**
4. â³ **Deploy to testnet and verify**
5. â³ **Build backend automation service**
6. â³ **Integrate price oracles**
7. â³ **Security audit** (external firm recommended)
8. â³ **Mainnet deployment**

---

## Questions for Product Team

1. **Collateral Amount**: What multiple of expected buyback cost (2x? 3x?)?
2. **Default Penalties**: Additional penalty beyond debt (e.g., 10% fee)?
3. **Grace Periods**: How many days before enforcement?
4. **Oracle Choice**: Pyth, Switchboard, or custom?
5. **AMM Design**: Custom AMM or DeepBook?
6. **Fee Structure**: Trading fees (0.3%?), platform cut?
7. **Insurance Pool**: Should platform maintain safety fund?

---

## License

MIT
